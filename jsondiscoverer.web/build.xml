<?xml version="1.0" encoding="UTF-8"?>
<!-- ====================================================================== 
     13/08/2015                                                        

     JSON discoverer    
     Build WAR
                   
     Javier Canovas (me@jlcanovas.es)                                                                
     ====================================================================== -->
<project name="JSON discoverer" default="buildProductionWAR">
    <description>
    	Build WAR
    </description>
	
	<path id="master-classpath">
		<fileset dir="WebContent/WEB-INF/lib">
	    	<include name="*.jar"/>
		</fileset>
	</path>
	
	<target name="buildProductionWAR" description="Builds the WAR with the production configuration">
		<delete dir="target"/>
		<mkdir dir="target/production"/>
		<mkdir dir="target/classes"/>
		
		<copy todir="target/production">
			<fileset dir="WebContent">
				<exclude name="**/discoverer.js"/>
				<exclude name="**/*.xmi"/>
				<exclude name="**/*.svg"/>
				<exclude name="**/config.properties*"/>
			</fileset>
		</copy>
		
		<copy file="WebContent/WEB-INF/config.properties.server" tofile="target/production/WEB-INF/config.properties"/>

        <copy file="WebContent/app/services/discoverer.js" tofile="target/production/app/services/discoverer.js" >
            <filterchain>
                <linecontains negate="true">
                    <contains value="%DEVELOPMENT%"/>
                </linecontains>
            </filterchain>
        </copy>
		
		<javac srcdir="src" destdir="target/classes" debug="off" includeantruntime="false" verbose="off">
			<classpath refid="master-classpath"/>
			<!-- this removes warning messages regarding BASE64Encoder and Timestamp -->
			<compilerarg value="-XDignore.symbol.file"/> 
		</javac>

        <war destfile="jsonDiscoverer.war" webxml="target/production/WEB-INF/web.xml">
        	<classes dir="target/classes"/>
        	<webinf dir="target/production/WEB-INF"/>
        	<fileset dir="target/production">
        		<exclude name="META-INF/**/*"/>
        		<exclude name="WEB-INF/**/*"/>	
        		<exclude name="workingDir/**/*.xmi"/>	
        		<exclude name="workingDir/**/*.graphdesc"/>	
        		<exclude name="workingDir/**/*.jpg"/>	
        		<exclude name="workingDir/**/*.ecore"/>	
        	</fileset>
        </war>

		<delete dir="target"/>
	</target>
</project>
